!function(e){try{e=angular.module("pipGuidance.Templates")}catch(t){e=angular.module("pipGuidance.Templates",[])}e.run(["$templateCache",function(e){e.put("guidance/guidance_dialog.html",'<md-dialog class="pip-dialog pip-guidance-dialog" layout="column" width="768" md-theme="{{theme}}"><div class="pip-header" layout="row"><h3 flex="" class="rm16">{{title | translate}}</h3><md-button class="pip-dialog-close" ng-click="onCancel()" aria-label="{{::\'CLOSE\' | translate}}"><span class="icon-cross"></span></md-button></div><div class="pip-body"><div class="pip-content"><pip-picture pip-src="imageUrl" ng-hide="!imageUrl || imageUrl == \'\'" class="bm16 center-block" ng-style="{ width: imageWidth, height: imageHeight, display: \'block\' }"></pip-picture><div class="bm16" pip-translate-html="{{::content}}"></div><md-button class="md-raised md-accent w-stretch" ng-click="onAction()" ng-hide="!action || action==\'\'" arial-label="{{::action | translate}}">{{::action | translate}}</md-button><md-checkbox aria-label="{{\'DO_NOT_SHOW\' | translate}}" class="w-stretch m0 tm16 regular_14" ng-model="hideToggle" ng-change="onHideToggle()" ng-show="showHideToggle">{{::\'GUIDANCE_DO_NOT_SHOW\' | translate}}</md-checkbox></div></div></md-dialog>')}])}(),function(e){try{e=angular.module("pipGuidance.Templates")}catch(t){e=angular.module("pipGuidance.Templates",[])}e.run(["$templateCache",function(e){e.put("intro_guidance/intro_guidance_dialog.html",'<md-dialog class="pip-dialog pip-guidance-dialog pip-guide-preview" layout="column" md-theme="{{theme}}"><div ng-if="!$routing" flex="" ng-swipe-left="onNextPage()" ng-swipe-right="onBackPage()" class="h-stretch layout layout-column {{\'bg-\' + data.pages[number].color}}"><div class="layout layout-row layout-align-space-between-center layout-align-xs-center-center w-stretch pip-guide-page"><md-button ng-click="onBackPage()" class="lm16 hide-xs" aria-label="BACK" ng-disabled="transaction.busy() || number == 0"><md-icon md-svg-icon="icons:arrow-left" class="pip-arrow-button" ng-class="{\'opacity-disabled\' :number == 0}"></md-icon></md-button><div class="layout layout-column layout-align-center-center bm16"><pip-collage class="flex-fixed" ng-if="data.pages[number].pic_id && (!data.pictures || !data.pictures[number])" pip-picture-ids="data.pages[number].picId" pip-unique-code="data.id" pip-multiple="false" pip-open="false" pip-rebind="true"></pip-collage><div class="pip-pic" ng-if="!data.pages[number].pic_id || data.pictures[number]" style="background-image: url({{data.pictures[number]}})"></div><div class="layout layout-column layout-align-center-center pip-text"><p class="pip-preview-title" ng-if="data.pages[number].title[ln]">{{data.pages[number].title[ln]}}</p><p class="pip-preview-content" ng-if="data.pages[number].content[ln]">{{data.pages[number].content[ln]}}</p></div></div><md-button ng-click="onNextPage()" class="rm16 hide-xs" aria-label="DOWN" ng-disabled="transaction.busy() || number == data.pages.length - 1"><md-icon md-svg-icon="icons:arrow-right" class="pip-arrow-button" ng-class="{\'opacity-disabled\' : number == data.pages.length - 1}"></md-icon></md-button></div><div class="flex-fixed flex w-stretch pip-guide-page-footer"><div layout="row" layout-align="center center" ng-if="data.pages.length > 1"><md-icon ng-repeat="radio in data.pages" ng-click="onChangePage($index)" class="pip-radio-button" md-svg-icon="{{radio != data.pages[number] ? \'icons:radio-off\' : \'icons:circle\'}}"></md-icon></div><div class="h64" layout="row" layout-align-xs="space-between center" layout-align="center center"><md-button ng-click="onBackPage()" class="lm16" ng-if="$mdMedia(\'xs\')" aria-label="BACK" ng-disabled="transaction.busy() || number == 0"><md-icon md-svg-icon="icons:arrow-left" class="pip-arrow-button" ng-class="{\'opacity-disabled\' :number == 0}"></md-icon></md-button><md-button ng-click="onClose()" class="pip-button-got rm8 lm8 {{number == data.pages.length - 1 ? \'fg-\' + data.pages[number].color : \'bg-\' + data.pages[number].color}}" ng-class="{\'md-raised\': number == data.pages.length - 1}" aria-label="NEXT" ng-disabled="transaction.busy()">GOT IT !</md-button><md-button ng-click="onNextPage()" class="rm16" ng-if="$mdMedia(\'xs\')" aria-label="DOWN" ng-disabled="transaction.busy() || number == data.pages.length - 1"><md-icon md-svg-icon="icons:arrow-right" class="pip-arrow-button" ng-class="{\'opacity-disabled\' : number == data.pages.length - 1}"></md-icon></md-button></div></div></div></md-dialog>')}])}(),function(e){try{e=angular.module("pipGuidance.Templates")}catch(t){e=angular.module("pipGuidance.Templates",[])}e.run(["$templateCache",function(e){e.put("tips/tip.template.html",'<div ng-if="title" class="pip-title p24-flex flex-fixed bp16">{{ title | translate }}</div><div class="pip-content pip-popover-content lp24-flex rp24-flex text-body1 bm64 pip-scroll" ng-class="{\'tm24\' : !title }"><div ng-if="image && $mdMedia(\'gt-xs\')" class="pip-pic"></div><pip-markdown pip-text="content" pip-rebind="true"></pip-markdown></div><div class="pip-footer lm24-flex rm24-flex position-bottom" layout="row" layout-align="start center"><a ng-if="link" target="_blank" href="{{ link }}" class="text-body2" flex="">{{ \'MORE_URL\' | translate }}</a><div ng-if="!link" flex=""></div><md-button ng-click="onNextClick()" class="rm0">{{ \'NEXT\' | translate }}</md-button></div>')}])}(),function(){"use strict";angular.module("pipGuidance",["pipTips.Service","pipIntroGuidance.Service","pipGuidance.Dialog","pipReleaseIntroDialog"])}(),function(){"use strict";var e=angular.module("pipGuidance.Dialog",["ngMaterial","pipTranslate","pipGuidance.Templates"]);e.config(["pipTranslateProvider",function(e){e.translations("en",{GUIDANCE_TITLE:"What should you do here?",GUIDANCE_ACTION:"Do it now!",GUIDANCE_DO_NOT_SHOW:"Don't show it again"}),e.translations("ru",{GUIDANCE_TITLE:"Что здесь делать?",GUIDANCE_ACTION:"Сделать это сейчас!",GUIDANCE_DO_NOT_SHOW:"Не показывать это снова"})}]),e.factory("pipGuidanceDialog",["$mdDialog",function(e){return{show:function(t,i,n){e.show({targetEvent:t.event,templateUrl:"guidance/guidance_dialog.html",controller:"pipGuidanceDialogController",locals:{params:t},clickOutsideToClose:!0}).then(function(){i&&i()},function(){n&&n()})}}}]),e.controller("pipGuidanceDialogController",["$scope","$rootScope","$mdDialog","params",function(e,t,i,n){e.theme=t.$theme,e.title=n.title||"GUIDANCE_TITLE",e.imageUrl=n.imageUrl||"",e.imageWidth=n.imageWidth||"100%",e.imageHeight=n.imageHeight||"150px",e.content=n.content,e.action=n.action||"GUIDANCE_ACTION",e.hideToggle=n.hideToggle,e.showHideToggle=null!=n.hideToggleCallback,e.onCancel=function(){i.cancel()},e.onAction=function(){i.hide()},e.onHideToggle=function(t){n.hideToggleCallback&&n.hideToggleCallback(e.hideToggle)}}])}(),function(){"use strict";var e=angular.module("pipReleaseIntroDialog",["ngMaterial","pipTranslate","pipGuidance.Templates"]);e.config(["pipTranslateProvider",function(e){e.translations("en",{GUIDANCE_TITLE:"What should you do here?",GUIDANCE_ACTION:"Do it now!",GUIDANCE_DO_NOT_SHOW:"Don't show it again"}),e.translations("ru",{GUIDANCE_TITLE:"Что здесь делать?",GUIDANCE_ACTION:"Сделать это сейчас!",GUIDANCE_DO_NOT_SHOW:"Не показывать это снова"})}]),e.factory("pipReleaseIntroDialog",["$mdDialog",function(e){return{show:function(t,i,n){e.show({targetEvent:t.event,templateUrl:"intro_guidance/intro_guidance_dialog.html",controller:"pipReleaseIntroDialogController",locals:{params:t},clickOutsideToClose:!0}).then(function(){i&&i()},function(){n&&n()})}}}]),e.controller("pipReleaseIntroDialogController",["$scope","$rootScope","$mdDialog","$mdMedia","params","$state",function(e,t,i,n,a,l){e.theme=t.$theme,e.settings=a.settings,e.admin=a.admin,e.$mdMedia=n;var o=a.guide;e.admin||e.settings[a.settingsName]&&e.settings[a.settingsName].lastId&&(a.settingsName="release"),e.number=0,e.ln=a.ln||t.$language||"en",e.data=o,_.each(e.data.pages,function(e){if(e.pic_id){var t=e.pic_id;e.picId=[],e.picId.push(t)}}),e.onChangePage=function(t){e.number=t},e.onBackPage=function(){0!=e.number&&(e.number-=1)},e.onNextPage=function(){e.number!=e.data.pages.length-1&&(e.number+=1)},e.onClose=function(){e.admin||(e.settings[a.settingsName].lastId=e.data.id,e.settings[a.settingsName].date=new Date,a.pipSettingsData.saveSettings(e.settings,a.settingsName)),i.cancel()}}])}(),function(){"use strict";var e=angular.module("pipIntroGuidance.Service",["pipReleaseIntroDialog"]);e.factory("pipGuidance",["pipReleaseIntroDialog","pipSettingsData","$rootScope",function(e,t,i){function n(i,n,a,l,o,s){i&&o.id==s.id&&e.show({guide:i,settings:n,settingsName:"intro"==i.type?"intro":"release",pipSettingsData:t,admin:a,ln:l})}function a(e,t){var i;return t.intro&&t.intro.lastId?(i=_.filter(e,function(e){return"new release"==e.type&&"completed"==e.status}),i=_.sortBy(i,function(e){return-new Date(e.created).getTime()}),!t.intro.date||i.length>0&&new Date(t.intro.date)<new Date(i[0].created)&&i[0].id!=t.release.lastId?i[0]:null):(i=_.filter(e,function(e){return"intro"==e.type&&"completed"==e.status}),i=_.sortBy(i,function(e){return-new Date(e.created).getTime()}),i[0])}return{showIntroReleaseGuide:n,findIntroReleaseGuide:a}}])}(),function(){"use strict";var e=angular.module("pipTips.Service",["pipGuidance.Templates"]);e.factory("pipTips",["$pipPopover","pipTipsData","pipRest","$timeout","$rootScope","pipSettingsData",function(e,t,i,n,a,l){function o(e){return"completed"==e.status}function s(e){return h[f]?!_.find(h[f]["extends"],{id:e.id}):!0}function c(e,t){return Math.random()-.5}function r(e,t,i){m=[],h=i,f=t;var n=_.filter(e,o);n=_.filter(n,s);for(var a=0;a<n.length;a++){var t=_.find(n[a].topics,function(e){return e==t});t&&m.push(n[a])}return m.sort(c),m}function p(t,n,a){function o(){t.title=t.locals.tips[t.index].title[t.locals.ln],t.content=t.locals.tips[t.index].content[t.locals.ln],t.locals.tips[t.index].pic_id&&(t.image=i.serverUrl()+"/api/parties/"+t.locals.tips[t.index].creator_id+"/files/"+t.locals.tips[t.index].pic_id+"/content"),t.link=t.locals.tips[t.index].more_url,t.image&&n(function(){var e=$(".pip-popover-backdrop"),i=e.find(".pip-popover");i.find(".pip-pic").css("background-image","url("+t.image+")")},100)}t.index=0,t.$mdMedia=a,o(),t.onNextClick=function(){if(console.log(t.locals.settings,t.locals.topic),t.locals.settings&&t.locals.topic&&t.locals.settings[t.locals.topic]){t.locals.settings[t.locals.topic]["extends"]||(t.locals.settings[t.locals.topic]["extends"]=[]),t.locals.settings[t.locals.topic]["extends"].push(t.locals.tips[t.index].id);var i=t.locals.settings[t.locals.topic]["extends"];if(t.locals.settings[t.locals.topic]["extends"].length>10)for(var n=0;10>n;n++)t.locals.settings[t.locals.topic]["extends"][n]=i[t.eIds.length-10+n];console.log(t.locals.settings),l.saveSettings(t.locals.settings,t.locals.topic)}t.index++,t.index==t.locals.tips.length?e.hide():(o(),e.resize())},t.$on("pipWindowResized",o)}function d(t,i,n){t&&t.length>0&&(e.hide(),e.show({element:n?n.currentTarget:null,"class":"pip-tip",cancelCallback:function(){return!1},locals:{tips:t,ln:i||"en",settings:h},controller:["$scope","$timeout","$mdMedia",p],templateUrl:"tips/tip.template.html"}))}function g(t,i,n,a,o){var s,i=i||"en",o=o||2,c=new Date;a&&a[n].tips?(s=(c.getTime()-new Date(a[n].tips).getTime())/864e5,s>o&&(e.hide(),d(t,i),a[n].tips=new Date,l.saveSettings(a,n))):a[n]&&(e.hide(),d(t,i),a[n].tips=new Date,l.saveSettings(a,n))}function u(e,i,n,a){t.readTips({item:{}},null,function(e){return r(e.data,n),a&&a(m),m},function(e){return null})}var m,f,h;return{getTips:u,filterTips:r,showTips:d,firstShowTips:g}}])}();