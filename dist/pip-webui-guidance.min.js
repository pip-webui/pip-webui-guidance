!function(){"use strict";angular.module("pipGuidance",["pipTips.Service","pipIntroGuidance.Service","pipGuidance.Dialog","pipReleaseIntroDialog"])}(window.angular),function(e){try{e=angular.module("pipGuidance.Templates")}catch(t){e=angular.module("pipGuidance.Templates",[])}e.run(["$templateCache",function(e){e.put("guidance/guidance_dialog.html",'<md-dialog class="pip-dialog pip-guidance-dialog layout-column" width="768" md-theme="{{theme}}"><div class="pip-header layout-row"><h3 class="rm16 flex">{{title | translate}}</h3><md-button class="pip-dialog-close" ng-click="onCancel()" aria-label="{{::\'CLOSE\' | translate}}"><span class="icon-cross"></span></md-button></div><div class="pip-body"><div class="pip-content"><pip-picture pip-src="imageUrl" ng-hide="!imageUrl || imageUrl == \'\'" class="bm16 center-block" ng-style="{ width: imageWidth, height: imageHeight, display: \'block\' }"></pip-picture><div class="bm16" pip-translate-html="{{::content}}"></div><md-button class="md-raised md-accent w-stretch" ng-click="onAction()" ng-hide="!action || action==\'\'" arial-label="{{::action | translate}}">{{::action | translate}}</md-button><md-checkbox aria-label="{{\'DO_NOT_SHOW\' | translate}}" class="w-stretch m0 tm16 regular_14" ng-model="hideToggle" ng-change="onHideToggle()" ng-show="showHideToggle">{{::\'GUIDANCE_DO_NOT_SHOW\' | translate}}</md-checkbox></div></div></md-dialog>')}])}(),function(e){try{e=angular.module("pipGuidance.Templates")}catch(t){e=angular.module("pipGuidance.Templates",[])}e.run(["$templateCache",function(e){e.put("intro_guidance/intro_guidance_dialog.html",'<md-dialog class="pip-dialog pip-guidance-dialog pip-guide-preview layout-column" md-theme="{{theme}}"><div ng-if="!$routing" ng-swipe-left="onNextPage()" ng-swipe-right="onBackPage()" class="h-stretch flex layout layout-column {{\'bg-\' + data.pages[number].color}}"><div class="layout layout-row layout-align-space-between-center layout-align-xs-center-center w-stretch pip-guide-page"><md-button ng-click="onBackPage()" class="lm16 hide-xs" aria-label="BACK" ng-disabled="transaction.busy() || number == 0"><md-icon md-svg-icon="icons:arrow-left" class="pip-arrow-button" ng-class="{\'opacity-disabled\' :number == 0}"></md-icon></md-button><div class="layout layout-column layout-align-center-center bm16"><pip-collage class="flex-fixed" ng-if="data.pages[number].pic_id && (!data.pictures || !data.pictures[number])" pip-picture-ids="data.pages[number].picId" pip-unique-code="data.id" pip-multiple="false" pip-open="false" pip-rebind="true"></pip-collage><div class="pip-pic" ng-if="!data.pages[number].pic_id || data.pictures[number]" style="background-image: url({{data.pictures[number]}})"></div><div class="layout layout-column layout-align-center-center pip-text"><p class="pip-preview-title" ng-if="data.pages[number].title[ln]">{{data.pages[number].title[ln]}}</p><p class="pip-preview-content" ng-if="data.pages[number].content[ln]">{{data.pages[number].content[ln]}}</p></div></div><md-button ng-click="onNextPage()" class="rm16 hide-xs" aria-label="DOWN" ng-disabled="transaction.busy() || number == data.pages.length - 1"><md-icon md-svg-icon="icons:arrow-right" class="pip-arrow-button" ng-class="{\'opacity-disabled\' : number == data.pages.length - 1}"></md-icon></md-button></div><div class="flex-fixed flex w-stretch pip-guide-page-footer"><div class="layout-row layout-align-center-center" ng-if="data.pages.length > 1"><md-icon ng-repeat="radio in data.pages" ng-click="onChangePage($index)" class="pip-radio-button" md-svg-icon="{{radio != data.pages[number] ? \'icons:radio-off\' : \'icons:circle\'}}"></md-icon></div><div class="h64 layout-row layout-align-xs-space-between-center layout-align-center-center"><md-button ng-click="onBackPage()" class="lm16" ng-if="$mdMedia(\'xs\')" aria-label="BACK" ng-disabled="transaction.busy() || number == 0"><md-icon md-svg-icon="icons:arrow-left" class="pip-arrow-button" ng-class="{\'opacity-disabled\' :number == 0}"></md-icon></md-button><md-button ng-click="onClose()" class="pip-button-got rm8 lm8 {{number == data.pages.length - 1 ? \'fg-\' + data.pages[number].color : \'bg-\' + data.pages[number].color}}" ng-class="{\'md-raised\': number == data.pages.length - 1}" aria-label="NEXT" ng-disabled="transaction.busy()">GOT IT !</md-button><md-button ng-click="onNextPage()" class="rm16" ng-if="$mdMedia(\'xs\')" aria-label="DOWN" ng-disabled="transaction.busy() || number == data.pages.length - 1"><md-icon md-svg-icon="icons:arrow-right" class="pip-arrow-button" ng-class="{\'opacity-disabled\' : number == data.pages.length - 1}"></md-icon></md-button></div></div></div></md-dialog>')}])}(),function(e){try{e=angular.module("pipGuidance.Templates")}catch(t){e=angular.module("pipGuidance.Templates",[])}e.run(["$templateCache",function(e){e.put("tips/tip.template.html",'<div ng-if="title" class="pip-title p24-flex flex-fixed bp16">{{ title | translate }}</div><div class="pip-content pip-popover-content lp24-flex rp24-flex text-body1 bm64 pip-scroll" ng-class="{\'tm24\' : !title }"><div ng-if="image && $mdMedia(\'gt-xs\')" class="pip-pic"></div><pip-markdown pip-text="content" pip-rebind="true"></pip-markdown></div><div class="pip-footer lm24-flex rm24-flex position-bottom layout-row layout-align-start-center"><a ng-if="link" target="_blank" href="{{ link }}" class="text-body2 flex">{{:: \'MORE_URL\' | translate }}</a><div ng-if="!link" class="flex"></div><md-button ng-click="onNextClick()" class="rm0">{{:: \'NEXT\' | translate }}</md-button></div>')}])}(),function(e){"use strict";var t=e.module("pipGuidance.Dialog",["ngMaterial","pipTranslate","pipGuidance.Templates"]);t.config(["pipTranslateProvider",function(e){e.translations("en",{GUIDANCE_TITLE:"What should you do here?",GUIDANCE_ACTION:"Do it now!",GUIDANCE_DO_NOT_SHOW:"Don't show it again"}),e.translations("ru",{GUIDANCE_TITLE:"Что здесь делать?",GUIDANCE_ACTION:"Сделать это сейчас!",GUIDANCE_DO_NOT_SHOW:"Не показывать это снова"})}]),t.factory("pipGuidanceDialog",["$mdDialog",function(e){return{show:function(t,i,n){e.show({targetEvent:t.event,templateUrl:"guidance/guidance_dialog.html",controller:"pipGuidanceDialogController",locals:{params:t},clickOutsideToClose:!0}).then(function(){i&&i()},function(){n&&n()})}}}]),t.controller("pipGuidanceDialogController",["$scope","$rootScope","$mdDialog","params",function(e,t,i,n){e.theme=t.$theme,e.title=n.title||"GUIDANCE_TITLE",e.imageUrl=n.imageUrl||"",e.imageWidth=n.imageWidth||"100%",e.imageHeight=n.imageHeight||"150px",e.content=n.content,e.action=n.action||"GUIDANCE_ACTION",e.hideToggle=n.hideToggle,e.showHideToggle=null!=n.hideToggleCallback,e.onCancel=function(){i.cancel()},e.onAction=function(){i.hide()},e.onHideToggle=function(){n.hideToggleCallback&&n.hideToggleCallback(e.hideToggle)}}])}(window.angular),function(e,t){"use strict";var i=e.module("pipReleaseIntroDialog",["ngMaterial","pipTranslate","pipGuidance.Templates"]);i.config(["pipTranslateProvider",function(e){e.translations("en",{GUIDANCE_TITLE:"What should you do here?",GUIDANCE_ACTION:"Do it now!",GUIDANCE_DO_NOT_SHOW:"Don't show it again"}),e.translations("ru",{GUIDANCE_TITLE:"Что здесь делать?",GUIDANCE_ACTION:"Сделать это сейчас!",GUIDANCE_DO_NOT_SHOW:"Не показывать это снова"})}]),i.factory("pipReleaseIntroDialog",["$mdDialog",function(e){return{show:function(t,i,n){e.show({targetEvent:t.event,templateUrl:"intro_guidance/intro_guidance_dialog.html",controller:"pipReleaseIntroDialogController",locals:{params:t},clickOutsideToClose:!0}).then(function(){i&&i()},function(){n&&n()})}}}]),i.controller("pipReleaseIntroDialogController",["$scope","$rootScope","$mdDialog","$mdMedia","params",function(e,i,n,a,l){e.theme=i.$theme,e.settings=l.settings,e.admin=l.admin,e.$mdMedia=a;var o=l.guide;!e.admin&&e.settings[l.settingsName]&&e.settings[l.settingsName].lastId&&(l.settingsName="release"),e.number=0,e.ln=l.ln||i.$language||"en",e.data=o,t.each(e.data.pages,function(e){if(e.pic_id){var t=e.pic_id;e.picId=[],e.picId.push(t)}}),e.onChangePage=function(t){e.number=t},e.onBackPage=function(){0!==e.number&&(e.number-=1)},e.onNextPage=function(){e.number!==e.data.pages.length-1&&(e.number+=1)},e.onClose=function(){e.admin||(e.settings[l.settingsName].lastId=e.data.id,e.settings[l.settingsName].date=new Date,l.pipDataSettings.saveSettings(e.settings,l.settingsName)),n.cancel()}}])}(window.angular,window._),function(e,t){"use strict";var i=e.module("pipIntroGuidance.Service",["pipReleaseIntroDialog"]);i.factory("pipGuidance",["pipReleaseIntroDialog","pipDataSettings","pipDataGuide","$rootScope",function(e,i,n,a){function l(i){n.readGuides({filter:i},function(i){i=t.filter(i,function(e){return e.type="completed"===e.status}),i.length>0&&e.show({guide:i[0],settings:{},settingsName:"new release",pipDataSettings:null,admin:!0,ln:a.$language})})}function o(i){n.readIntroGuides({filter:i},function(i){i=t.filter(i,function(e){return e.type="completed"===e.status}),i.length>0&&e.show({guide:i[0],settings:{},settingsName:"intro",pipDataSettings:null,admin:!0,ln:a.$language})})}function s(t,n,a,l,o,s){t&&o.id===s.id&&e.show({guide:t,settings:n,settingsName:"intro"===t.type?"intro":"release",pipDataSettings:i,admin:a,ln:l})}function c(e,i,n){var a,n=n||"pip-life";return i.intro&&i.intro.lastId?(a=t.filter(e,function(e){return"new release"===e.type&&"completed"===e.status&&e.app===n}),a=t.sortBy(a,function(e){return-new Date(e.created).getTime()}),!i.intro.date||a.length>0&&new Date(i.intro.date)<new Date(a[0].created)&&a[0].id!=i.release.lastId?a[0]:null):(a=t.filter(e,function(e){return"intro"===e.type&&"completed"===e.status&&e.app===n}),a=t.sortBy(a,function(e){return-new Date(e.created).getTime()}),a[0])}return{showIntroReleaseGuide:s,findIntroReleaseGuide:c,showIntroGuidance:o,showReleaseGuidance:l}}])}(window.angular,window._),function(e){"use strict";var t=e.module("pipTips.Service",["pipGuidance.Templates"]);t.factory("pipTips",["$timeout","$rootScope","$pipPopover","pipDataTip","pipRest","pipDataSettings",function(e,t,i,n,a,l){function o(e){return"completed"===e.status}function s(){return Math.random()-.5}function c(e,t){g=[];var i,n=_.filter(e,o);for(i=0;i<n.length;i++){var t=_.find(n[i].topics,function(e){return e==t});t&&g.push(n[i])}return g.sort(s),g}function r(e,t,n){function l(){e.title=e.locals.tips[e.index].title[e.locals.ln],e.content=e.locals.tips[e.index].content[e.locals.ln],e.locals.tips[e.index].pic_id&&(e.image=a.serverUrl()+"/api/parties/"+e.locals.tips[e.index].creator_id+"/files/"+e.locals.tips[e.index].pic_id+"/content"),e.link=e.locals.tips[e.index].more_url,e.image&&t(function(){var t=$(".pip-popover-backdrop"),i=t.find(".pip-popover");i.find(".pip-pic").css("background-image","url("+e.image+")")},100)}e.index=0,e.$mdMedia=n,l(),e.onNextClick=function(){e.index++,e.index===e.locals.tips.length?i.hide():(l(),i.resize())},e.$on("pipWindowResized",l)}function p(e,t,n){e&&e.length>0&&(i.hide(),i.show({element:n?n.currentTarget:null,"class":"pip-tip",cancelCallback:function(){return!1},locals:{tips:e,ln:t||"en"},controller:["$scope","$timeout","$mdMedia",r],templateUrl:"tips/tip.template.html"}))}function d(e,t,n,a,o){var s,t=t||"en",o=o||2,c=new Date;a&&a[n].tips?(s=(c.getTime()-new Date(a[n].tips).getTime())/864e5,s>o&&(i.hide(),p(e,t),a[n].tips=new Date,l.saveSettings(a,n))):a[n]&&(i.hide(),p(e,t),a[n].tips=new Date,l.saveSettings(a,n))}function u(e,t,i,a){n.readTips({item:{}},null,function(e){return c(e.data,i),a&&a(g),g},function(){return null})}var g;return{getTips:u,filterTips:c,showTips:p,firstShowTips:d}}])}(window.angular);